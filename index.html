<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi-Room Chat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #f0f0f0;
    }
    #setup, #chatUI { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; }
    #messages { height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; background: #f7f7f7; }
    .message { padding: 8px 10px; border-radius: 8px; margin: 5px 0; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; }
    #chatUI { display: none; }
  </style>
</head>
<body>
  <div id="setup">
    <h2>Join or Create a Chatroom</h2>
    <input id="userName" placeholder="Enter your name" />
    <input id="roomName" placeholder="Chatroom name (new or existing)" />
    <label>Pick your message color:</label>
    <input type="color" id="colorPicker" value="#d1e7dd" />
    <button id="joinBtn">Enter Chat</button>
    <div>
      <h4>Available Rooms:</h4>
      <ul id="roomList"></ul>
    </div>
  </div>

  <div id="chatUI">
    <h2 id="chatroomTitle">Chatroom</h2>
    <div id="messages"></div>
    <input id="msgInput" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ✅ Your Firebase config here
    const firebaseConfig = {
      apiKey: "AIzaSyAI0839Q7BoAGx-5IgHlyCRnkwVUAizWao",
      authDomain: "chat-4ff44.firebaseapp.com",
      databaseURL: "https://chat-4ff44-default-rtdb.firebaseio.com",
      projectId: "chat-4ff44",
      storageBucket: "chat-4ff44.firebasestorage.app",
      messagingSenderId: "307828591312",
      appId: "1:307828591312:web:97ce0dcbc6e0add050acd5",
      measurementId: "G-XBRY21C6TB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const setup = document.getElementById("setup");
    const chatUI = document.getElementById("chatUI");
    const messagesDiv = document.getElementById("messages");
    const joinBtn = document.getElementById("joinBtn");
    const sendBtn = document.getElementById("sendBtn");
    const chatroomTitle = document.getElementById("chatroomTitle");
    const roomList = document.getElementById("roomList");

    let currentRoom = "", userName = "", userColor = "";

    // 🌐 List available rooms
    db.ref("chatrooms").on("value", snapshot => {
      roomList.innerHTML = "";
      snapshot.forEach(roomSnap => {
        const li = document.createElement("li");
        li.textContent = roomSnap.key;
        li.style.cursor = "pointer";
        li.onclick = () => document.getElementById("roomName").value = roomSnap.key;
        roomList.appendChild(li);
      });
    });

    // 🚪 Join or create chatroom
    joinBtn.onclick = () => {
      userName = document.getElementById("userName").value.trim();
      currentRoom = document.getElementById("roomName").value.trim();
      userColor = document.getElementById("colorPicker").value;

      if (!userName || !currentRoom) return alert("Please enter name and room.");

      chatroomTitle.textContent = `Chatroom: ${currentRoom}`;
      setup.style.display = "none";
      chatUI.style.display = "block";

      // Start listening to messages
      db.ref(`chatrooms/${currentRoom}`).off(); // Reset if needed
      db.ref(`chatrooms/${currentRoom}`).orderByChild("timestamp").on("child_added", snap => {
        const msg = snap.val();
        const div = document.createElement("div");
        div.className = "message";
        div.style.background = msg.color || "#eee";
        div.textContent = `[${msg.name}]: ${msg.text}`;
        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      });
    };

    // 💬 Send message
    sendBtn.onclick = () => {
      const text = document.getElementById("msgInput").value.trim();
      if (!text) return;

      db.ref(`chatrooms/${currentRoom}`).push({
        name: userName,
        text: text,
        color: userColor,
        timestamp: Date.now()
      });

      document.getElementById("msgInput").value = "";
    };
  </script>
</body>
</html>
